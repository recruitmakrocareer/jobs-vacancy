<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤ - Makro</title>

  <style>
    :root { 
      --max: 1100px; 
      --makro-red: #ED1C24; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á Makro */
      --makro-red-dark: #c41219;
      --bg-color: #f6f7fb;
    }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", sans-serif; background:var(--bg-color); color:#111; }
    
    /* === ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ Header (Theme ‡∏™‡∏µ‡πÅ‡∏î‡∏á Makro) === */
    header { 
      padding:40px 18px; 
      color:#fff; 
      background: linear-gradient(135deg, var(--makro-red) 0%, #ff4d4d 100%); /* ‡πÑ‡∏•‡πà‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏°‡∏µ‡∏°‡∏¥‡∏ï‡∏¥ */
      box-shadow: 0 4px 20px rgba(237, 28, 36, 0.2);
    }
    
    header .wrap { 
      max-width: var(--max); 
      margin:auto; 
      display: flex; 
      align-items: center; 
      gap: 24px; 
      justify-content: space-between; 
    }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏£‡∏π‡∏õ Logo (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß) */
    header .logo {
      width: 140px;         /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
      height: 80px;         /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ü‡∏¥‡∏Å‡∏ã‡πå */
      object-fit: contain;
      background: #fff;     
      border-radius: 12px;
      padding: 12px 20px;   
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      flex-shrink: 0;
    }

    header .header-text { flex: 1; }
    header h1 { margin:0 0 8px; font-size:36px; line-height: 1.1; font-weight: 800; letter-spacing: -0.5px; }
    header p { margin:0; font-size:18px; opacity:.95; font-weight: 400; }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (Mobile) */
    @media (max-width: 600px) {
      header .wrap { flex-direction: column-reverse; text-align: center; gap: 20px; }
      header h1 { font-size: 28px; }
      header .logo { width: 120px; height: auto; padding: 10px 16px; }
    }
    /* ================================== */

    main { max-width: var(--max); margin:auto; padding:24px 18px 60px; }
    .card { background:#fff; border-radius:16px; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,.04); margin-bottom:20px; border: 1px solid rgba(0,0,0,0.03); }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    
    /* Pills & UI Elements */
    .pill { background:#fff1f2; color:var(--makro-red-dark); font-weight:700; font-size:13px; padding:6px 12px; border-radius:999px; letter-spacing: 0.5px; }
    .muted { opacity:.6; font-size: 14px; }

    input, select { padding:12px 16px; border-radius:12px; border:1px solid #e5e7eb; font-size:15px; background:#fff; transition: border-color 0.2s; }
    input:focus, select:focus { outline: none; border-color: var(--makro-red); box-shadow: 0 0 0 3px rgba(237, 28, 36, 0.1); }
    
    .btn { border:0; border-radius:12px; padding:12px 20px; font-weight:600; cursor:pointer; font-size: 15px; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
    
    /* ‡∏õ‡∏∏‡πà‡∏° Primary ‡∏™‡∏µ‡πÅ‡∏î‡∏á Makro */
    .btn.primary { background:var(--makro-red); color:#fff; box-shadow: 0 4px 12px rgba(237, 28, 36, 0.3); }
    .btn.primary:hover { background:var(--makro-red-dark); transform: translateY(-1px); }
    
    .btn.ghost { background:#f3f4f6; color:#4b5563; }
    .btn.ghost:hover { background:#e5e7eb; color:#111; }

    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:16px; margin-top:20px; }
    
    /* Job Card Styling */
    .job { 
      border:1px solid #f3f4f6; 
      border-radius:16px; 
      padding:20px; 
      background:#fff; 
      transition: all 0.2s ease;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .job:hover { 
      transform: translateY(-4px); 
      border-color: #fecaca; 
      box-shadow: 0 12px 24px rgba(237, 28, 36, 0.08); 
    }
    .job h3 { margin:12px 0 8px; font-size:18px; line-height:1.4; color: #111827; font-weight: 700; flex: 1; }
    
    .meta { font-size:14px; color: #6b7280; margin-bottom: 16px; }
    .meta div { margin:6px 0; display:flex; align-items:center; gap:8px; }
    .meta i { font-style: normal; font-size: 16px; }
    
    .status-badge { display:inline-flex; align-items: center; gap:4px; font-size:12px; padding:4px 10px; border-radius:6px; font-weight:600; letter-spacing: 0.3px; }
    .status-open { background:#ecfdf5; color:#059669; border: 1px solid #d1fae5; }
    .status-closed { background:#fef2f2; color:#991b1b; }

    iframe { width:100%; height:900px; border:0; border-radius:16px; background:#fff; margin-top:12px; border: 1px solid #e5e7eb; }
    
    /* Loading Spinner ‡∏™‡∏µ‡πÅ‡∏î‡∏á */
    .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--makro-red); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 30px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
    <div class="header-text">
      <h1>‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</h1>
      <p>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô Logo -->
    <img id="companyLogo" 
         src="" 
         class="logo" 
         alt="Makro Logo" 
         referrerpolicy="no-referrer"
         onerror="this.style.display='none'">
  </div>
</header>

<main>
  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
  <section class="card">
    <div class="row" style="justify-content:space-between">
      <div>
        <span class="pill">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</span>
        <div class="muted" style="margin-top:4px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à</div>
      </div>
      <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Wording ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏≠ -->
      <button class="btn primary" id="refreshBtn">
        <span style="font-size:18px">‚Üª</span> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô
      </button>
    </div>

    <div class="row" style="margin-top:20px">
      <input id="q" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£..." style="flex:1;min-width:240px">
      <select id="filterBranch" style="min-width:180px"><option value="">üè¢ ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option></select>
      <button class="btn ghost" id="clearBtn">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
    </div>
  </section>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -->
  <section class="card">
    <div id="statusMsg" class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    <div id="jobs" class="grid"></div>
  </section>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
  <section class="card" id="applySection" style="display:none;">
    <span class="pill">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô</span>
    <p class="muted" style="margin-top:8px">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: <b id="applyPositionName" style="color:var(--makro-red)">...</b></p>
    <!-- Microsoft Forms iframe ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏™‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
    <div id="iframeContainer"></div>
  </section>
</main>

<script>
/* ================= CONFIG (‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ) ================= */

// 1. ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå CSV ‡∏à‡∏≤‡∏Å Google Sheet (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡∏°‡πà)
const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-aAempo3sn5LxfvOq0MRB2YMRs2rFTjocqidMYpwGUKdqG1DGUz5uCEfd3ddNjxStdWifLgBbrqXV/pub?output=csv"; 

// 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û Logo (‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÉ‡∏ô Repo ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î)
const COMPANY_LOGO_URL = "./LOGOT.png"; 

// 3. Microsoft Form Link
const FORM_BASE_URL = "https://forms.office.com/r/wabJfczd4Z";

// =========================================================

/* ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
let allJobs = [];
let branches = new Set();

/* DOM Elements */
const elQ = document.getElementById("q");
const elFilterBranch = document.getElementById("filterBranch");
const elClearBtn = document.getElementById("clearBtn");
const elStatus = document.getElementById("statusMsg");
const elJobs = document.getElementById("jobs");
const elRefreshBtn = document.getElementById("refreshBtn");
const elApplySection = document.getElementById("applySection");
const elApplyPositionName = document.getElementById("applyPositionName");
const elIframeContainer = document.getElementById("iframeContainer");

/* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö */
window.onload = init;

async function init() {
  if (COMPANY_LOGO_URL) {
    document.getElementById("companyLogo").src = COMPANY_LOGO_URL;
  }
  await loadData();
  
  elQ.addEventListener("input", renderJobs);
  elFilterBranch.addEventListener("change", renderJobs);
  elClearBtn.addEventListener("click", () => {
    elQ.value = "";
    elFilterBranch.value = "";
    renderJobs();
  });
  elRefreshBtn.addEventListener("click", loadData);
}

/* ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets */
async function loadData() {
  elStatus.innerHTML = '<div class="loader"></div>';
  elJobs.innerHTML = "";
  
  try {
    const response = await fetch(GOOGLE_SHEET_CSV_URL);
    if (!response.ok) throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
    
    const text = await response.text();
    const data = parseCSV(text); // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°

    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£ Mapping ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏≠
    // Column E (index 4) ‡∏Ñ‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
    // ‡∏ï‡∏±‡∏î description ‡∏≠‡∏≠‡∏Å
    allJobs = data.map(row => ({
      code: row[0] || "",
      branch: row[1] || "",
      position: row[4] || "", // ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô Column E (Index 4)
      status: row[3] || "Closed"
    })).filter(job => job.position && job.branch);

    updateBranchDropdown();
    renderJobs();
    elStatus.textContent = `‡∏û‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏á ${allJobs.length} ‡∏≠‡∏±‡∏ï‡∏£‡∏≤ (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ${new Date().toLocaleTimeString('th-TH')})`;

  } catch (error) {
    console.error(error);
    elStatus.innerHTML = `<span style="color:red">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</span>`;
  }
}

/* ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏á‡∏≤‡∏ô */
function renderJobs() {
  const searchText = elQ.value.toLowerCase();
  const branchFilter = elFilterBranch.value;

  const filtered = allJobs.filter(job => {
    const matchSearch = job.position.toLowerCase().includes(searchText) || 
                        job.branch.toLowerCase().includes(searchText);
    const matchBranch = branchFilter === "" || job.branch === branchFilter;
    const matchStatus = job.status.toLowerCase().trim() === "open";

    return matchSearch && matchBranch && matchStatus;
  });

  elJobs.innerHTML = "";

  if (filtered.length === 0) {
    elJobs.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:40px;opacity:0.6">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>`;
    return;
  }

  filtered.forEach(job => {
    const card = document.createElement("div");
    card.className = "job";
    // ‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (Description) ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å HTML
    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:start;">
        <span class="status-badge status-open">‚óè ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</span>
        <!-- ‡∏•‡∏ö‡∏™‡πà‡∏ß‡∏ô REF ‡∏≠‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏≠ -->
      </div>
      
      <h3>${job.position}</h3>
      
      <div class="meta">
        <div>üè¢ <strong>${job.branch}</strong></div>
      </div>
      
      <button class="btn ghost" style="width:100%; margin-top:auto;" onclick="openApplyForm('${job.position}', '${job.branch}')">
        ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏µ‡πâ üëâ
      </button>
    `;
    elJobs.appendChild(card);
  });
}

/* ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô */
window.openApplyForm = function(position, branch) {
  elApplySection.style.display = "block";
  elApplyPositionName.textContent = `${position} (${branch})`;
  elApplySection.scrollIntoView({ behavior: "smooth" });
  
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Mobile (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ iframe ‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏ô Android/iOS)
  elIframeContainer.innerHTML = `
    <div style="text-align:center; margin-bottom:12px;">
       <a href="${FORM_BASE_URL}" target="_blank" class="btn ghost" style="display:inline-flex; align-items:center; gap:6px; font-size:14px; color:#4b5563; background:#f3f4f6; border:1px solid #e5e7eb;">
         <span>‚ö†Ô∏è ‡∏´‡∏≤‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á</span> <span style="text-decoration:underline; font-weight:bold;">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</span>
       </a>
    </div>
    <iframe src="${FORM_BASE_URL}" allowfullscreen></iframe>
  `;
}

/* ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Dropdown ‡∏™‡∏≤‡∏Ç‡∏≤ */
function updateBranchDropdown() {
  const branches = [...new Set(allJobs.map(j => j.branch))].sort();
  const currentVal = elFilterBranch.value;
  elFilterBranch.innerHTML = '<option value="">üè¢ ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>';
  branches.forEach(b => {
    const opt = document.createElement("option");
    opt.value = b;
    opt.textContent = b;
    elFilterBranch.appendChild(opt);
  });
  if (branches.includes(currentVal)) elFilterBranch.value = currentVal;
}

/* ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á CSV ‡πÅ‡∏ö‡∏ö‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ) */
function parseCSV(text) {
  const lines = text.split(/\r?\n/);
  // ‡πÉ‡∏ä‡πâ Logic Loop ‡πÅ‡∏ó‡∏ô Regex ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö Column
  return lines.map(line => {
    if (!line.trim()) return null;
    const row = [];
    let inQuote = false;
    let start = 0;
    
    for (let i = 0; i < line.length; i++) {
      if (line[i] === '"') {
        inQuote = !inQuote;
      } else if (line[i] === ',' && !inQuote) {
        let field = line.substring(start, i);
        // ‡∏•‡∏ö Quote ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å
        if (field.startsWith('"') && field.endsWith('"')) {
            field = field.slice(1, -1).replace(/""/g, '"');
        }
        row.push(field.trim());
        start = i + 1;
      }
    }
    // ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏Å field ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
    let field = line.substring(start);
    if (field.startsWith('"') && field.endsWith('"')) {
        field = field.slice(1, -1).replace(/""/g, '"');
    }
    row.push(field.trim());
    return row;
  }).filter(row => row !== null);
}
</script>

</body>
</html>
